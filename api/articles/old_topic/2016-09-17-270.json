{"title":"ElasticSearch的LUA客户端","uid":"fc17f56f18c6188c98c1c7bfedd06596","slug":"old_topic/2016-09-17-270","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-16T11:44:51.868Z","comments":true,"path":"api/articles/old_topic/2016-09-17-270.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"content":"<p>作者：糖果</p>\n<p>从Github上看，有一位叫做Dhaval Kapil老师完成了ElasticSearch for Lua的工作，另一位来自阿根廷的叫做Cristian Haunsen的老师，完成了ElasticSearch for Lapis的客户端程序写作工作,dhavalkapil还有一个博客可以访问：<a href=\"http://dhavalkapil.com\">dhavalkapil.com</a></p>\n<p>这次实验的目标，是测试一下本地直接运行ES for Lua，然后在Lapis中访问ES，我们的日志在ES，可以用Lua，也可以用Python完成ES的访问工作， Python没有问题，Lua就看这个实验了。</p>\n<p>测试代码，如下：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> elasticsearch = <span class=\"built_in\">require</span> <span class=\"string\">&quot;elasticsearch&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> client = elasticsearch.client&#123;</span><br><span class=\"line\">    hosts = &#123;</span><br><span class=\"line\">      &#123; <span class=\"comment\">-- Ignoring any of the following hosts parameters is allowed.</span></span><br><span class=\"line\">        <span class=\"comment\">-- The default shall be set</span></span><br><span class=\"line\">        protocol = <span class=\"string\">&quot;http&quot;</span>,</span><br><span class=\"line\">        host = <span class=\"string\">&quot;localhost&quot;</span>,</span><br><span class=\"line\">        port = <span class=\"number\">9200</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"comment\">-- Optional parameters</span></span><br><span class=\"line\">    params = &#123;</span><br><span class=\"line\">      pingTimeout = <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">-- Will connect to default host/port</span></span><br><span class=\"line\"><span class=\"keyword\">local</span> client = elasticsearch.client()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">local</span> data, err = client:info()</span><br></pre></td></tr></table></figure>\n<p>Full list of params（全参数列表）:</p>\n<h5 id=\"pingtimeout-the-timeout-of-a-connection-for-ping-and-sniff-request-default-is-1\"><a class=\"markdownIt-Anchor\" href=\"#pingtimeout-the-timeout-of-a-connection-for-ping-and-sniff-request-default-is-1\"></a> pingTimeout : The timeout of a connection for ping and sniff request. Default is 1.</h5>\n<h5 id=\"selector-the-type-of-selection-strategy-to-be-used-default-is-roundrobinselector\"><a class=\"markdownIt-Anchor\" href=\"#selector-the-type-of-selection-strategy-to-be-used-default-is-roundrobinselector\"></a> selector : The type of selection strategy to be used. Default is RoundRobinSelector.</h5>\n<h5 id=\"connectionpool-the-type-of-connection-pool-to-be-used-default-is-staticconnectionpool\"><a class=\"markdownIt-Anchor\" href=\"#connectionpool-the-type-of-connection-pool-to-be-used-default-is-staticconnectionpool\"></a> connectionPool : The type of connection pool to be used. Default is StaticConnectionPool.</h5>\n<h5 id=\"connectionpoolsettings-the-connection-pool-settings\"><a class=\"markdownIt-Anchor\" href=\"#connectionpoolsettings-the-connection-pool-settings\"></a> connectionPoolSettings : The connection pool settings,</h5>\n<h5 id=\"maxretrycount-the-maximum-times-to-retry-if-a-particular-connection-fails\"><a class=\"markdownIt-Anchor\" href=\"#maxretrycount-the-maximum-times-to-retry-if-a-particular-connection-fails\"></a> maxRetryCount : The maximum times to retry if a particular connection fails.</h5>\n<h5 id=\"loglevel-the-level-of-logging-to-be-done-default-is-warning\"><a class=\"markdownIt-Anchor\" href=\"#loglevel-the-level-of-logging-to-be-done-default-is-warning\"></a> logLevel : The level of logging to be done. Default is warning.</h5>\n<h5 id=\"getting-info-of-elasticsearch-server取得es服务器信息\"><a class=\"markdownIt-Anchor\" href=\"#getting-info-of-elasticsearch-server取得es服务器信息\"></a> Getting info of elasticsearch server（取得ES服务器信息）</h5>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> data, err = client:info()</span><br></pre></td></tr></table></figure>\n<h4 id=\"index-a-document创建索引文档\"><a class=\"markdownIt-Anchor\" href=\"#index-a-document创建索引文档\"></a> Index a document（创建索引文档）</h4>\n<p>Everything is represented as a lua table.(一切皆为Lua Table)</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">local</span> data, err = client:index&#123;</span><br><span class=\"line\">  index = <span class=\"string\">&quot;my_index&quot;</span>,</span><br><span class=\"line\">  <span class=\"built_in\">type</span> = <span class=\"string\">&quot;my_type&quot;</span>,</span><br><span class=\"line\">  id = <span class=\"string\">&quot;my_doc&quot;</span>,</span><br><span class=\"line\">  body = &#123;</span><br><span class=\"line\">    my_key = <span class=\"string\">&quot;my_param&quot;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"get-a-document取得文档\"><a class=\"markdownIt-Anchor\" href=\"#get-a-document取得文档\"></a> Get a document（取得文档）</h4>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data, err = client:get&#123;</span><br><span class=\"line\">  index = <span class=\"string\">&quot;my_index&quot;</span>,</span><br><span class=\"line\">  <span class=\"built_in\">type</span> = <span class=\"string\">&quot;my_type&quot;</span>,</span><br><span class=\"line\">  id = <span class=\"string\">&quot;my_doc&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"delete-a-document删除文档\"><a class=\"markdownIt-Anchor\" href=\"#delete-a-document删除文档\"></a> Delete a document（删除文档）</h4>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data, err = client:delete&#123;</span><br><span class=\"line\">  index = <span class=\"string\">&quot;my_index&quot;</span>,</span><br><span class=\"line\">  <span class=\"built_in\">type</span> = <span class=\"string\">&quot;my_type&quot;</span>,</span><br><span class=\"line\">  id = <span class=\"string\">&quot;my_doc&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"searching-a-document-检索文档\"><a class=\"markdownIt-Anchor\" href=\"#searching-a-document-检索文档\"></a> Searching a document （检索文档）</h4>\n<p>You can search a document using either query string:（使有查询字符进行检索）</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data, err = client:search&#123;</span><br><span class=\"line\">  index = <span class=\"string\">&quot;my_index&quot;</span>,</span><br><span class=\"line\">  <span class=\"built_in\">type</span> = <span class=\"string\">&quot;my_type&quot;</span>,</span><br><span class=\"line\">  q = <span class=\"string\">&quot;my_key:my_param&quot;</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"or-either-a-request-body或是请求体\"><a class=\"markdownIt-Anchor\" href=\"#or-either-a-request-body或是请求体\"></a> Or either a request body:(或是请求体)</h4>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data, err = client:search&#123;</span><br><span class=\"line\">  index = <span class=\"string\">&quot;my_index&quot;</span>,</span><br><span class=\"line\">  <span class=\"built_in\">type</span> = <span class=\"string\">&quot;my_type&quot;</span>,</span><br><span class=\"line\">  body = &#123;</span><br><span class=\"line\">    query = &#123;</span><br><span class=\"line\">      <span class=\"built_in\">match</span> = &#123;</span><br><span class=\"line\">        my_key = <span class=\"string\">&quot;my_param&quot;</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"update-a-document更新文档\"><a class=\"markdownIt-Anchor\" href=\"#update-a-document更新文档\"></a> Update a document（更新文档）</h4>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data, err = client:update&#123;</span><br><span class=\"line\">  index = <span class=\"string\">&quot;my_index&quot;</span>,</span><br><span class=\"line\">  <span class=\"built_in\">type</span> = <span class=\"string\">&quot;my_type&quot;</span>,</span><br><span class=\"line\">  id = <span class=\"string\">&quot;my_doc&quot;</span>,</span><br><span class=\"line\">  body = &#123;</span><br><span class=\"line\">    doc = &#123;</span><br><span class=\"line\">      my_key = <span class=\"string\">&quot;new_param&quot;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><a href=\"http://lua.ren/topic/270/elasticsearch%E7%9A%84lua%E5%AE%A2%E6%88%B7%E7%AB%AF\">原文</a></p>\n<p>PS：本文测式用代码都来自至官方ES-LUA的Github的Readme。</p>\n","text":"作者：糖果 从Github上看，有一位叫做Dhaval Kapil老师完成了ElasticSearch for Lua的工作，另一位来自阿根廷的叫做Cristian Haunsen的老师，完成了ElasticSearch for Lapis的客户端程序写作工作,dhavalkap...","link":"","photos":[],"count_time":{"symbolsCount":"2.8k","symbolsTime":"3 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#pingtimeout-the-timeout-of-a-connection-for-ping-and-sniff-request-default-is-1\"><span class=\"toc-text\"> pingTimeout : The timeout of a connection for ping and sniff request. Default is 1.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#selector-the-type-of-selection-strategy-to-be-used-default-is-roundrobinselector\"><span class=\"toc-text\"> selector : The type of selection strategy to be used. Default is RoundRobinSelector.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#connectionpool-the-type-of-connection-pool-to-be-used-default-is-staticconnectionpool\"><span class=\"toc-text\"> connectionPool : The type of connection pool to be used. Default is StaticConnectionPool.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#connectionpoolsettings-the-connection-pool-settings\"><span class=\"toc-text\"> connectionPoolSettings : The connection pool settings,</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#maxretrycount-the-maximum-times-to-retry-if-a-particular-connection-fails\"><span class=\"toc-text\"> maxRetryCount : The maximum times to retry if a particular connection fails.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#loglevel-the-level-of-logging-to-be-done-default-is-warning\"><span class=\"toc-text\"> logLevel : The level of logging to be done. Default is warning.</span></a></li><li class=\"toc-item toc-level-5\"><a class=\"toc-link\" href=\"#getting-info-of-elasticsearch-server%E5%8F%96%E5%BE%97es%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BF%A1%E6%81%AF\"><span class=\"toc-text\"> Getting info of elasticsearch server（取得ES服务器信息）</span></a></li></ol></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#index-a-document%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%96%87%E6%A1%A3\"><span class=\"toc-text\"> Index a document（创建索引文档）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#get-a-document%E5%8F%96%E5%BE%97%E6%96%87%E6%A1%A3\"><span class=\"toc-text\"> Get a document（取得文档）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#delete-a-document%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3\"><span class=\"toc-text\"> Delete a document（删除文档）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#searching-a-document-%E6%A3%80%E7%B4%A2%E6%96%87%E6%A1%A3\"><span class=\"toc-text\"> Searching a document （检索文档）</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#or-either-a-request-body%E6%88%96%E6%98%AF%E8%AF%B7%E6%B1%82%E4%BD%93\"><span class=\"toc-text\"> Or either a request body:(或是请求体)</span></a></li><li class=\"toc-item toc-level-4\"><a class=\"toc-link\" href=\"#update-a-document%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3\"><span class=\"toc-text\"> Update a document（更新文档）</span></a>","author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"ORC索引页显示的Lapis实现","uid":"d2259f558f383bf9636ac7b5a9eaea5a","slug":"old_topic/2016-09-17-269","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-16T11:44:51.868Z","comments":true,"path":"api/articles/old_topic/2016-09-17-269.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":[],"text":"作者：糖果 ORC是是用LOR框架完成的，这次尝试实现用Lapis来实现，ORC索引页面的显示， 国为ORC是后端前端分开的， 实际上后端只要根据用输入返回按接口定义的JSON数据就好。 这个实验会涉及到几个最学用的点： 1.简单的用SQL对业务表进行left join，这个和语...","link":"","photos":[],"count_time":{"symbolsCount":"9.3k","symbolsTime":"8 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Threading的Timer是否可以被wait和communicate阻塞","uid":"1f0e7f34ab02983eb011a2f068cfda64","slug":"old_topic/2016-09-17-268","date":"2016-09-17T14:50:18.000Z","updated":"2024-03-16T11:44:51.868Z","comments":true,"path":"api/articles/old_topic/2016-09-17-268.json","keywords":"AIGC,LLM,糖果AIGC实验室","cover":null,"text":"作者：糖果 测试的内容是将Timer的使用和Popen的使用混合在一起，测试当wait()和communicate()被调用时，是否会阻塞主进程的Timer。 找到Timer在Python2.7里的源码位置： 12345678910111213141516171819202122...","link":"","photos":[],"count_time":{"symbolsCount":"20k","symbolsTime":"18 mins."},"categories":[{"name":"topic","slug":"topic","count":308,"path":"api/categories/topic.json"}],"tags":[],"author":{"name":"安全书","slug":"blog-author","avatar":"https://img-blog.csdnimg.cn/20210313122054101.png","link":"/","description":"《墨守之道-Web服务安全架构与实践》","socials":{"github":"https://github.com/shengnoah","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"https://weibo.com/u/3732639263","zhihu":"https://www.zhihu.com/people/openresty","csdn":"","juejin":"","customs":{}}}}}